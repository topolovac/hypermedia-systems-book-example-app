package templates

import "contact.app/model"
import "fmt"

templ Contacts(contacts []model.Contact, search_param string, page int) {
	@Layout() {
		<form action="/contacts" method="GET">
			<label for="search">Search Term</label>
			<input id="search" type="search" name="search" value={ search_param }/>
			<input type="submit" value="Search"/>
		</form>
		<table>
			<thead>
				<tr>
					<th>First</th>
					<th>Last</th>
					<th>Phone</th>
					<th>Email</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				for _, contact := range contacts {
					<tr>
						<td>{ contact.First }</td>
						<td>{ contact.Last } </td>
						<td>{ contact.Phone } </td>
						<td>{ contact.Email }</td>
						<td>
							<a href={ templ.URL(fmt.Sprintf("/contacts/%d/edit", contact.Id)) }>Edit</a>
							<a href={ templ.URL(fmt.Sprintf("/contacts/%d", contact.Id)) }>View</a>
						</td>
					</tr>
				}
				if len(contacts) == 10 {
					<tr>
						<td>
							<span
								hx-target="closest tr"
								hx-swap="outerHTML"
								hx-trigger="revealed"
								hx-select="tbody > tr"
								hx-get={ fmt.Sprintf("/contacts?page=%d", page+1) }
							>
								Loading more...
							</span>
						</td>
					</tr>
				}
			</tbody>
		</table>
		<p>
			<a href="/contacts/new">Add Contact</a>
		</p>
	}
}
